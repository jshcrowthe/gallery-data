<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<!--
An element providing a solution to no problem in particular.

Example:

    <gallery-data></gallery-data>

@group Seed Elements
@element gallery-data
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="gallery-data">
  <template>
    <iron-ajax auto
           url="https://my-dummy-api.herokuapp.com/artifacts"
           handle-as="json"
           on-response="_handleArtifacts"></iron-ajax>    
    <iron-ajax auto
           url="https://my-dummy-api.herokuapp.com/albums"
           handle-as="json"
           on-response="_handleAlbums"></iron-ajax>
   <iron-ajax id='indvAlbum' auto headers='[[_headers]]'
           handle-as="json"
           on-response="_handleIndvAlbum"></iron-ajax>   
  </template>
</dom-module>

<script>
(function() {
  function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
      var c = ca[i];
      while (c.charAt(0)==' ') c = c.substring(1,c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
  }

  var artifacts = [];

  Polymer({

    is: 'gallery-data',

    properties: {
      // USER INPUTS

      // EXPORTED PROPS
      
      /**
       * A list of artifacts based on the current state
       * @type {Object}
       */
      artifacts: {
        type: Array,
        readOnly: true,
        notify: true,
        value: function() { return []; }
      },

      /**
       * The total artifact count
       * @type {Object}
       */
      totalArtifacts: {
        type: Number,
        readOnly: true,
        notify: true,
        value: 0
      },

      /**
       * A list of albums for a given user
       * @type {Object}
       */
      albums: {
        type: Array,
        readOnly: true,
        notify: true,
        value: function() { return []; }
      },

      /**
       * An album object for a given album
       * @type {Object}
       */
      album: {
        type: Object,
        readOnly: true,
        notify: true,
        value: function() { return {}; }
      },
    },
    
    _handleArtifacts: function(event, request) {
      if (!request || !request.response) return;
      var res = request.response;

      this._setTotalArtifacts(res.count);
      if (Array.isArray(res.artifacts)) {
        artifacts = res.artifacts;
        if (!this.album) this._setArtifacts(artifacts);
      }
    },

    _handleAlbums: function(event, request) {
      if (!request || !request.response) return;
      var res = request.response;

      if (Array.isArray(res.album)) this._setAlbums((res.album));
    },

    _handleIndvAlbum: function(event, request) {
      if (!request || !request.response) return;
      var res = request.response;

      if (Array.isArray(res.artifacts)) this._setArtifacts((res.artifacts));
      if (res.album) this._setAlbum(res.album);
    },

  });
})();

</script>
